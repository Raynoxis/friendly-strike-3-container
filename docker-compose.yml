version: '3.8'

# =============================================================================
# Friendly-Strike 3 - Docker Compose
# =============================================================================
#
# Variables d'environnement:
#   DISPLAY       - Serveur X11 (défaut: 192.168.0.20:0.0)
#   PULSE_SOCKET  - Socket PulseAudio (défaut: /run/user/1000/pulse/native)
#
# Utilisation:
#   podman-compose --profile client up game
#   podman-compose --profile server up hoster
#   podman-compose --profile server-headless up -d hoster-headless
#
# =============================================================================

services:
  # ===========================================================================
  # Jeu client
  # ===========================================================================
  game:
    build: ./build
    image: friendly-strike3:latest
    container_name: fs3-game
    network_mode: host
    environment:
      - DISPLAY=${DISPLAY:-192.168.0.20:0.0}
      - PULSE_SERVER=unix:${PULSE_SOCKET:-/run/user/1000/pulse/native}
    volumes:
      - ./build/game/Data:/game/Data
      - ${PULSE_SOCKET:-/run/user/1000/pulse/native}:${PULSE_SOCKET:-/run/user/1000/pulse/native}:ro
    devices:
      - /dev/snd:/dev/snd
    command: game
    profiles:
      - client

  # ===========================================================================
  # Serveur avec GUI
  # ===========================================================================
  hoster:
    build: ./build
    image: friendly-strike3:latest
    container_name: fs3-hoster
    network_mode: host
    environment:
      - DISPLAY=${DISPLAY:-192.168.0.20:0.0}
    volumes:
      - ./build/game/FS3hoster/Data:/game/FS3hoster/Data
      - ./build/game/Arenes:/game/Arenes
    command: hoster
    profiles:
      - server

