version: '3.8'

# =============================================================================
# Friendly-Strike 3 - Docker Compose
# =============================================================================
#
# Environment variables:
#   DISPLAY       - X11 server (default: 192.168.0.20:0.0)
#   PULSE_SOCKET  - PulseAudio socket (default: /run/user/1000/pulse/native)
#   FS3_IMAGE     - Docker Hub image (default: docker.io/raynoxis/friendly-strike-3:latest)
#
# Usage:
#   podman-compose --profile client up game
#   podman-compose --profile server up hoster
#
# =============================================================================

services:
  # ===========================================================================
  # Game client
  # ===========================================================================
  game:
    image: ${FS3_IMAGE:-docker.io/raynoxis/friendly-strike-3:latest}
    container_name: fs3-game
    network_mode: host
    environment:
      - DISPLAY=${DISPLAY:-192.168.0.20:0.0}
      - PULSE_SERVER=unix:${PULSE_SOCKET:-/run/user/1000/pulse/native}
    volumes:
      - ./build/game/Data:/game/Data
      - ${PULSE_SOCKET:-/run/user/1000/pulse/native}:${PULSE_SOCKET:-/run/user/1000/pulse/native}:ro
    devices:
      - /dev/snd:/dev/snd
    command: game
    profiles:
      - client

  # ===========================================================================
  # Server with GUI
  # ===========================================================================
  hoster:
    image: ${FS3_IMAGE:-docker.io/raynoxis/friendly-strike-3:latest}
    container_name: fs3-hoster
    network_mode: host
    environment:
      - DISPLAY=${DISPLAY:-192.168.0.20:0.0}
    volumes:
      - ./build/game/FS3hoster/Data:/game/FS3hoster/Data
      - ./build/game/Arenes:/game/Arenes
    command: hoster
    profiles:
      - server

